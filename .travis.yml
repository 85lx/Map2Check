dist: xenial
language: cpp

env:
    global:
        - GIT_NAME: Herbert Rocha
        - GIT_EMAIL: herberthb12@gmail.com
        - TRAVIS_REPO_SLUG: hbgit/Map2Check

services:
- docker
before_script:
- docker build -t hrocha/mapdevel --no-cache -f Dockerfile .
- docker build -t hrocha/benchexecrun --no-cache -f utils/benchexecrun/Dockerfile
  utils/benchexecrun/
script:
- docker run --rm -v $(pwd):/home/map2check/devel_tool/mygitclone:Z --user $(id -u):$(id
  -g) hrocha/mapdevel /bin/bash -c "cd /home/map2check/devel_tool/mygitclone; ./make-release.sh;
  ./make-unit-test.sh"
- "./make-regression-test.sh t"
- docker run --rm -v $(pwd):/home/map2check/devel_tool/mygitclone:Z --user $(id -u):$(id
  -g) hrocha/mapdevel /bin/bash -c "cd /home/map2check/devel_tool/mygitclone; ./check_code_style.py
  -t -c -p"

notifications:
  email:
    recipients:
    - herberthb12@gmail.com
    - rafa.sa.xp@gmail.com
    on_success: never
    on_failure: never

before_deploy:
    - sudo rm -rf release/*.map2check
    - sudo rm -rf release/results
    - ./deploy.sh

before_install:
          - >-
            openssl aes-256-cbc 
            -K $encrypted_e6f8e0bf4c27_key 
            -iv $encrypted_e6f8e0bf4c27_iv 
            -in github_deploy_key.enc 
            -out github_deploy_key 
            -d
            - chmod 600 github_deploy_key
            - eval $(ssh-agent -s)
            - ssh-add github_deploy_key

deploy:
  skip_cleanup: true  
  provider: releases
  api_key:
    secure: ${GH_TOKEN}
  file_glob: true
  file: release/**/*
  draft: true
  on:
    tags: false
    repo: hbgit/Map2Check
    branch: develop
