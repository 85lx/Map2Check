dist: xenial
language: cpp

env:
    global:
        - secure: "vBwzRUhPRbJaeE9rWEZDlDZHzHwFecpyPJzOpGkKtVQ3zoqqtfBkIBh9vDpsP/TxkzUBlznhu1IHnETZgwTNsG8H7tH+nLdQjQrygETrvo7cIFzltex2da/NisV7mcuSaA8rX9kqC+F0DK11UgjUVD3gezxXZQB5bdRUUUxHr82U9lWuu6F1T7MoawWWl97UCJAYngk1qCg6Cl3JY16mpzqH/frHacwbUeM8I9jUvZR9R9KJ9uS2UdF22BeCrxuCvrZDO0R644Hpp4j2cGyeZCygZYURHHqgG3NkT7bSvjWyLMZY0X+4ZB4iKaM4Ixk58DUxa/8a0LYVeV9yAz4mMtZvZRKQBCYOBl1ymFHng23qBwotp8jih8FKizPDsf+MdGdfwgNAUz+6ubvIt0QtR2EJXsDDKgHzZo0nb4rVoU5/9zfIh7oYPC/8ckW2DKtNREN3z1RePupe8u15kJDLoC1LFz6s/eJFRZXWaC77iOMKOOt3UCDItQnerMfyESy1LUJVgZtzPub7zF4PKLEBwvXz86plaJmSJs6FbgpZ+zeMjVP33GCGo+FyojP1qbC3qTZQZaRbK3AmE1aGDvF0+JnybGsa2JQhARogzrLWqUq0m8yyCNSKZsTLPlGFwgMw/ejdhqwreNRN60vyD1lDs9867ki4qsprfpiEpAe57NY=" 
        - GIT_NAME: Herbert Rocha
        - GIT_EMAIL: herberthb12@gmail.com
        - TRAVIS_REPO_SLUG: hbgit/Map2Check

services:
- docker
before_script:
- docker build -t hrocha/mapdevel --no-cache -f Dockerfile .
- docker build -t hrocha/benchexecrun --no-cache -f utils/benchexecrun/Dockerfile
  utils/benchexecrun/
script:
- docker run --rm -v $(pwd):/home/map2check/devel_tool/mygitclone:Z --user $(id -u):$(id
  -g) hrocha/mapdevel /bin/bash -c "cd /home/map2check/devel_tool/mygitclone; ./make-release.sh;
  ./make-unit-test.sh"
- "./make-regression-test.sh t"
- docker run --rm -v $(pwd):/home/map2check/devel_tool/mygitclone:Z --user $(id -u):$(id
  -g) hrocha/mapdevel /bin/bash -c "cd /home/map2check/devel_tool/mygitclone; ./check_code_style.py
  -t -c -p"
notifications:
  email:
    recipients:
    - herberthb12@gmail.com
    - rafa.sa.xp@gmail.com
    on_success: never
    on_failure: never

before_deploy:
    - sudo rm -rf release/*.map2check
    - sudo rm -rf release/results
    - ./deploy.sh

deploy:
  skip_cleanup: true  
  provider: releases
  api_key:
    secure: ${GH_TOKEN}
  file_glob: true
  file: release/**/*
  draft: true
  on:
    tags: false
    repo: hbgit/Map2Check
    branch: develop
